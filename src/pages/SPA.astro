---
import { createStaticHandler } from '@remix-run/router';

import { routes } from '../components/routes';
import Layout from '../layouts/Docs.astro';
import { App } from '../qgp/react';
import { setContext } from '../ssr/context';

const { query } = createStaticHandler(routes());
let context = await query(Astro.request);

if (!('statusCode' in context)) {
	// https://docs.astro.build/en/guides/server-side-rendering/#response
	return new Response(null, {
		status: context.status || 404,
		statusText: context.statusText || 'Not Found',
	});
}
// can't imagine this is good for SSR with multiple users
setContext(context);
---

<Layout>
	<App client:load />
</Layout>
